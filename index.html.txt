
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Color of the Day</title>
  <style>
    body { font-family: Arial; text-align: center; padding: 20px; }
    #preview { max-width: 200px; margin-top: 10px; }
    #map { height: 400px; width: 80%; margin: 20px auto; }
    input, button { margin-top: 10px; }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>

  <!-- Leaflet Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>

<h1>🌈 Color of the Day</h1>
<p>Today's color: <span id="colorName">Green</span></p>

<input type="file" id="fileInput" accept="image/*" />
<button onclick="uploadImage()">Upload Photo</button>
<br>
<img id="preview" src="" alt="Image preview">

<div id="map"></div>

<script>
  // ===== Firebase Config =====
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const storage = firebase.storage();
  const db = firebase.firestore();

  // ===== Leaflet Map Setup =====
  const map = L.map('map').setView([20, 0], 2); // عرض عالمي
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // ===== Upload Function =====
  function uploadImage() {
    const file = document.getElementById("fileInput").files[0];
    if (!file) { alert("Please select a file!"); return; }

    // الحصول على موقع المستخدم
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((position) => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;

        const storageRef = storage.ref('images/' + file.name);
        storageRef.put(file).then(() => {
          storageRef.getDownloadURL().then((url) => {
            document.getElementById("preview").src = url;

            // حفظ URL والإحداثيات في Firestore
            db.collection('photos').add({
              url: url,
              lat: lat,
              lon: lon,
              timestamp: new Date()
            });

            // إضافة الصورة على الخريطة
            L.marker([lat, lon]).addTo(map)
              .bindPopup(`<img src="${url}" width="100">`).openPopup();
          });
        }).catch(err => alert("Upload failed: " + err));

      }, () => { alert("Cannot access location!"); });
    } else { alert("Geolocation not supported"); }
  }

  // ===== Change color daily =====
  const colors = ["Red","Green","Blue","Yellow","Purple","Orange"];
  const today = new Date().getDate(); // اليوم من الشهر
  document.getElementById("colorName").textContent = colors[today % colors.length];
</script>

</body>
</html>